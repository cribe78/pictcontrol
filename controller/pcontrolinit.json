<?php

require("sub/head.php");

if ($_SERVER['REQUEST_METHOD'] == 'POST') {
    $tt = $_POST['tt'];
    $tn = $_POST['tn'];
    $ctllist = $_POST['ctllist'];

    $resp['pcontrols'] = array();

    foreach ($ctllist as $ctl) {
        //pclog("pcontrolinit: tt={$ctl['tt']},tn={$ctl['tn']},ct={$ctl['ct']},cn={$ctl['cn']} "); 
        if($ctl['tt'] == 'switcher-dxp' ||
            $ctl['tt'] == 'audio-onkyo') {
            // These are handled by the pcontrol daemon now, skip
        }
        else {  
            $val = getPcontrol($ctl['tt'], $ctl['tn'], $ctl['ct'], $ctl['cn']);
            if ($val != null) {
                $resp['pcontrols'][] = $val;
            }
            else {
                $resp['error'] = array( "tt" => $tt,    
                                        "tn" => $tn );
            }
        }
    }

    $resp['status'] = 1;
    jsonResponse($resp);
}   
